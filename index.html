 
<!DOCTYPE html>

<html>
    <header>
        <meta charset="UTF-8">
        
        <link rel="stylesheet" type="text/css" href="leaflet/leaflet.css" /> 
        <link rel="stylesheet" type="text/css" href="main.css" /> 

        <script type="text/javascript" src="leaflet/leaflet.js" ></script>
        <script type="text/javascript" src="jquery.min.js" ></script>

        

        <title>leaflet Location</title>
        

    </header>

    <body>

        <div id="mapid"></div>

        <script >

            //data array
            var data = [];
            var deviceData = [];
            //test
            var phoneData=[
                [14.77684264, -17.35403951], //yeumbeul
                [14.39058989, -16.52920706], //fatick
                [14.72877149, -17.27537563], //rufisque
            ]

            //red_marker
            var redIcon = L.icon({
                iconUrl: 'icon/map-marker-r.png', 

                iconSize:     [24, 24], // size of the icon
                iconAnchor:     [12, 24], // icon position 
                popupAnchor:  [0, -24] // point from which the popup should open relative to the iconAnchor
            });   
            //orange_marker
            var orangeIcon = L.icon({
                iconUrl: 'icon/map-marker-o.png', //à changer

                iconSize:     [24, 24], 
                iconAnchor:     [12, 24], 
                popupAnchor:  [0, -24] 
            }); 
            
            //green_marker
            var greenIcon = L.icon({
                iconUrl: 'icon/map-marker-g.png', //à changer

                iconSize:     [24, 24],
                iconAnchor:     [12, 24],
                popupAnchor:  [0, -24]
            }); 


            //initializing map 
            var mylat = '14.71005856';
            var mylon = '-17.17218771';
            var myzoom = '10';
            var map = L.map('mapid').setView([mylat, mylon], myzoom);
            L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png?{foo}', {foo: 'bar'}).addTo(map); 

            //fary proposed the idea of ​​saving the coordinates in a database
            var districts = [
                [12.51580947, -16.22216687], //ziguinchor
                [12.47418596, -16.61544292], //oussouye
                [12.906471, -16.16068321], //bignona
                [12.92597876, -16.59570466], //diouloulou
                [112.73949185, -16.46284813], //thionck-essyl 
                [14.61639591, -17.07178086], //popenguine
                [15.07439107, -16.83484927], //tivaouane
                [15.12489901, -16.43077657], //mekhe
                [14.45658477, -16.95041897], //mbour
                [14.77918049, -16.71251518], //khombole
                [14.79928841, -17.01117706], //pout
                [14.25919244, -16.79197549], //joal
                [14.51300549, -16.70671389], //thiadiaye
                [14.64921441, -16.87260553], //thies
                [14.18041567, -14.31108864], //koupentoum
                [14.00050946, -12.19997906], //kidira
                [14.80085431, -12.4450916], //bakel
                [13.46782841, -13.37693037], //tambacounda
                [13.76428314, -12.64558916], //diankhemakhan
                [14.14755557, -13.10561135], //goudiry
                [13.6626569, -14.23677841], //makacoulibantang
                [12.63298302, -15.51013299], //goudomp
                [13.13357149, -15.60281623], //bounkiling
                [12.80570351, -15.61518508], //sedhiou
                [15.95504335, -16.37399598], //SL
                [16.28198715, -16.09469256], //richard-toll
                [16.32247122, -14.90280357], //podor
                [16.04282155, -14.23199106], //pete
                [16.25452182, -15.56426913], //dagana
                [15.77589175, -16.30539863], //sakal
                [15.58484462, -16.18908936], //louga
                [15.83922571, -15.83675366], //keur-momar-sarr
                [15.40917919, -16.42524839], //kebemer
                [15.20891563, -14.99023961], //linguere
                [15.51035368, -15.4139388], //dahra
                [15.15214191, -15.9973071], //darou-mousty
                [15.49239133, -15.96076697], //coki
                [13.21400568, -14.86500281], //medina-yoro-foulah
                [12.98490885, -13.87470385], //velingara
                [12.85479621, -14.65574686], //kolda
                [12.97256958, -11.82930724], //saraya
                [12.60031655, -12.79785214], //salemata
                [12.76554789, -12.43488023], //kedougou
                [13.73250701, -15.83397989], //nioro du ripd
                [13.9995786, -16.01041495], //ndoffane
                [14.2820569, -15.91284708], //guinguineo
                [14.23270908, -16.20665609], //kaolack
                [14.35463082, -15.25398256], //malem-hoddar
                [14.20339805, -14.85714566], //koungueul
                [14.12869694, -15.44638518], //kaffrine
                [14.04959593, -15.68222738], //birkelane
                [14.76648767, -16.21636758], //diourbel 
                [14.80147197, -16.48308766], //bambey
                [14.87459921, -15.822732], //touba
                [14.74584831, -15.83429212], //mbacke
                [14.80656994, -17.22083423], //sangalkam
                [14.75287578, -17.39638223], //pikine
                [14.78915991, -17.31898822], //keur-massar
                [14.71005856, -17.17218771], //diamniadio
                [14.77505614, -17.3946307], //gueidawaye
                [14.74736364, -17.33511537], //mbao
                [14.73634429, -17.44903397], //dkn
                [14.67426822, -17.44547783], //dks
                [14.71200008, -17.43321656], //dkc
                [14.73031601, -17.48317313], //dko
                [15.02581041, -14.13708972], //ranerou
                [14.97401521, -13.12836149], //kanel
                [15.89056804, -13.73934713], //thilogne
                [15.63622875, -13.57683986], //matam
                [13.72519766, -16.38891057], //sokone
                [14.01392341, -16.35856856], //passy
                [13.93467222, -16.61166729], //foundiougne
                [14.17373309, -16.62792796], //dioffior
                [14.49762123, -16.40182859], //niakhar
                [14.52623571, -15.83807076], //gossas
                [14.39015081, -16.28392518], //diakhao
                [14.77684264, -17.35403951], //yeumbeul
                [14.39058989, -16.52920706], //fatick
                [14.72877149, -17.27537563], //rufisque
            ]; 
            var markers=[]; //marker array
            var circles=[]; //circles array

            //add many markers using a loop 
                districts.forEach(function(point){
                    var marker=L.marker([point[0], point[1]], {icon: redIcon}).addTo(map).bindPopup("mettre des données");
                    markers.push(marker);  
                    var circle= L.circle([point[0], point[1]], {
                        color: '',
                        fillColor: '#f03',
                        fillOpacity: 0, //hidden
                        radius: 1000
                    }).addTo(map);
                    circles.push(circle);
         
                });

            //logic to change the marker icon 

            //function contain to check wether an object is in an array or not
            function contain(array,object){
                let state=false;
                for (elt of array){
                    if(elt[0]==object[0] && elt[1]==object[1]){
                        state=true;
                        break;
                    }
                }

                return state;

            }

            var marked=[];
            var match = [];
            var latlng_phone;

            //execute every 2s

     var runLogic=setInterval(function(){
            circles.forEach(function(circle){
                latlng_circle=circle.getLatLng();
                phoneData.forEach(function (location) {
                        latlng_phone = new L.LatLng(location[0], location[1]); //create a geographical point with the given lat and long
                        if (latlng_phone.distanceTo(latlng_circle) < 1000 && !contain(marked,location)) { 
                            //match.push(location); 
                            //change the marker icon to orange
                            L.marker([location[0], location[1]], {icon: orangeIcon}).addTo(map).bindPopup("ajouter des données" +"<br>"+
                            "<div>"+
                            "<span class='lat'>lat: "+location[0]+"</span>"+ "<br>"+"<span class='lng'>lng: "+location[1]+"</span>"+ "<br><br>"+
                            "<button style='background-color:#4cd137; border-radius:5px;' type='button' class='btn btn-success'>marquer</button>"+"</div>"); 
                        }
                });

            });



             //catch the click event on the buttons
            
            let btnElts=document.getElementsByClassName("btn"); 
            for(let btn of btnElts){
                 btn.addEventListener("click",function(e){
                     //we get coodinates
                     let current_lat=btn.parentElement.children[0].textContent.split(":")[1].trim();
                     let current_lng=btn.parentElement.children[2].textContent.split(":")[1].trim();
                     //change the icon to green
                     let m=L.marker([current_lat, current_lng], {icon: greenIcon}).addTo(map).bindPopup("mettre des données");
                     marked.push([parseFloat(current_lat),parseFloat(current_lng)]);
                     console.log(marked);
    
    });

}

 }, 1000);










    





                    
            //ajax request to get phone Coordinates and data
            //Screening phone Coordinates on the map		
            // $.ajax({
            //     type: 'GET',
            //     data: JSON.stringify(data),
            //     contentType: 'application/json',
            //     url: 'http://10.1.7.38:3000/phoneLocation',						
            //     success: function(data) { 
                    
            //         $.each(data, function(key, value){
            //             phoneData.push([value.latitude, value.longitude]);
            //         });
            //         var phoneLine = L.polyline(phoneData).addTo(map); 

            //         //add many markers using a loop interval 
            //         var i = 0;

            //             L.marker([data[i]['latitude'], data[i]['longitude']], {icon: blueIcon}).addTo(map).bindPopup("<table> <tr> <th>time: </th><td>" + data[i]['time'] + "</td> </tr> <tr> <th>temperature:</th><td>" + data[i]['latitude'] + "</td></tr> <tr><th>humidity:</th><td>" + data[i]['longitude'] + "</td></tr> </table>");
    
            //             if (++i === data.length) {
            //                 window.clearInterval(intervalMarker);
            //             } 
            //         //test popup in a marker 
            //     }
            // });
           


        </script> 

    </body>
 </html>
 </html>
